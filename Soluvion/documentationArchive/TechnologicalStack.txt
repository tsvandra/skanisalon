================================================================================
TECHNIKAI STACK DOKUMENTÁCIÓ: SOLUVION (SKANI SALON)
================================================================================
Dátum:    2026.02.06.
Verzió:   1.2 (Technical Deep Dive)
Típus:    Rendszerarchitektúra és Biztonság

[ 1. BACKEND ECOSYSTEM (.NET CORE) ]

A rendszer magja a Microsoft .NET 10 keretrendszerre épül, amely a nagyvállalati 
stabilitást ötvözi a modern felhõ-technológiákkal.

- Keretrendszer:  .NET 10 (ASP.NET Core Web API)
- Nyelv:          C# 14
- Architekturális Minta: MVC (Model-View-Controller) - API Controllers
- Adatelérés (ORM): Entity Framework Core (Code-First megközelítés)

Kulcsfontosságú NuGet Csomagok:
  > Npgsql.EntityFrameworkCore.PostgreSQL: A Postgres adatbázis meghajtója.
  > BCrypt.Net-Next: Kriptográfiai jelszókezelés (lásd a Biztonság részt).
  > System.IdentityModel.Tokens.Jwt: JWT generálás és validálás.
  > Swashbuckle.AspNetCore: Swagger/OpenAPI dokumentáció generálás.

Dependency Injection (DI):
  A rendszer a beépített .NET DI konténert használja a szolgáltatások 
  (pl. DbContext, Services) injektálására, biztosítva a modularitást és 
  tesztelhetõséget.

- CloudinaryDotNet: Felhő alapú képtároláshoz és manipulációhoz (a lokális WWWROOT tárolás kiváltására).

--------------------------------------------------------------------------------

[ 2. ADATBÁZIS RÉTEG ]

A rendszer relációs adatbázist használ, amely a Railway felhõjében fut.
- Motor:          PostgreSQL 16+
- Hosting:        Railway (Dockerizált környezet, külön PROD és STAGING)
- Kapcsolat:      TCP Proxy keresztül (DBeaver esetén jdbc URL + sslmode=require)
- Migrációk:      EF Core Migrations (Automatikus migráció futásidőben: db.Database.Migrate())
- Biztonsági Mentés: Backblaze B2 Cloud Storage (Automatizált napi mentések pg_dump formátumban, titkosítva).

Adatmodell Struktúra (Részlet):
  - Companies:    A bérlõk (szalonok) adatai. (PK: Id)
  - Users:        Adminisztrátorok/Felhasználók. (FK: CompanyId)
  - Services:     Szolgáltatások árlistája. (FK: CompanyId)
  - Galleries:    Feltöltött képek metaadatai. (FK: CompanyId)

--------------------------------------------------------------------------------

[ 3. BIZTONSÁG ÉS AUTENTIKÁCIÓ (Security Stack) ]

Ez a rendszer egyik legkritikusabb pontja. Nem tárolunk jelszavakat nyílt szövegként.

A. Jelszó Hashing (A hiányzó láncszem):
   A jelszavak tárolására a **BCrypt** algoritmust használjuk.
   
   - Technológia: BCrypt (Blowfish cipher alapú).
   - Mûködés: 
     1. Regisztrációkor a rendszer generál egy véletlenszerû "Salt"-ot (sót).
     2. A jelszót összefûzi a sóval, és többszörösen hash-eli (Work Factor).
     3. Az adatbázisba csak a hash kerül mentésre.
   - Elõny: Védelmet nyújt a Rainbow Table támadások és a Brute Force ellen 
     (mivel a hash generálása szándékosan lassú).

B. Autentikáció (Stateless):
   - Szabvány: JWT (JSON Web Token).
   - Típus: Bearer Token.
   - Aláírás: HMACSHA512 (Szimmetrikus kulcsú titkosítás).
   - Payload (Claims): A token tartalmazza a felhasználó adatait:
       > NameIdentifier (User ID)
       > Name (Felhasználónév)
       > CompanyId (Melyik céghez tartozik - Multi-tenancy kulcs!)
   
C. Hálózati Biztonság:
   - CORS (Cross-Origin Resource Sharing): Szigorúan szabályozott házirend.
     Csak a Netlify domain és a Localhost (fejlesztéshez) engedélyezett.
   - HTTPS: Kötelezõ titkosított csatorna (a Railway és Netlify automatikusan kezeli).

--------------------------------------------------------------------------------

[ 4. FRONTEND ECOSYSTEM (VUE.JS) ]

A kliens oldal egy modern SPA (Single Page Application).

- Keretrendszer:  Vue 3 (Composition API, <script setup> szintaxis)
- Build Tool:     Vite (Gyors HMR - Hot Module Replacement)
- Nyelv:          JavaScript (ESNext) / JSDoc típusokkal

UI & Design:
  - Komponens Könyvtár: PrimeVue (Button, Input, Dialog, TabView, Card).
  - CSS: Egyedi CSS + CSS Variables (Dinamikus színezéshez).
  - Ikonok: PrimeIcons.
  - Drag & Drop: vuedraggable (Sortable.js wrapper Vue 3-hoz) - A szolgáltatások és kategóriák rendezéséhez.

Állapotkezelés (State Management):
  - Lokális State: `ref`, `reactive`.
  - Globális State: Vue `provide/inject` minta (pl. a Company adatok átadására).
  - Router: Vue Router (WebHistory módban).

API Kommunikáció:
  - Kliens: Axios.
  - Konfiguráció: BaseURL beállítása környezeti változókból.
  - Interceptors: (Tervben) A token automatikus csatolása minden kérés fejlécéhez.

- PrimeVue Tabs (TabView, TabPanel): A Beállítások (SettingsView) űrlapjainak rendszerezéséhez.


--------------------------------------------------------------------------------

[ 5. INFRASTRUKTÚRA ÉS DEVOPS ]

A rendszer haladó CI/CD (Continuous Integration / Deployment) alapokon mûködik, éles (Production) és teszt (Staging) környezetekkel.

Backend Pipeline (Railway):
  - Környezetek: Külön 'production' és 'staging' environment.
  - Trigger: Git Push a `main` ágra (PROD), vagy a `develop` ágra (STAGING).
  - Folyamat: Docker Image építése -> Konténer indítása -> Automatikus EF Core migráció lefutása.

Frontend Pipeline (Netlify - Branch Deploys):
  - Trigger: Git Push.
  - Production: A `main` ág frissíti a fő domaint (pl. skanisalon.sk).
  - Staging / Branch Deploy: A `develop` ág automatikusan egy dedikált teszt linkre fordul (develop--soluvion.netlify.app).
  - Környezeti Változók: A Netlify UI-on "Different value for each deploy context" beállítással külön VITE_API_URL mutat a PROD és a STAGING backendre.

  --------------------------------------------------------------------------------

  Architektúra / Composables:
- useAutoSaveQueue.js: Egyedi composable az optimista UI frissítésekhez és a gyors API hívások (pl. csúszka mozgatás, drag-and-drop) sorbaállításához, a versenyhelyzetek (race conditions) elkerülése érdekében.

  --------------------------------------------------------------------------------

  === AI & 3RD PARTY INTEGRÁCIÓK ===

1. OpenAI Integration:
   - Library: Hivatalos `OpenAI` .NET kliens.
   - Modell: `gpt-5.2` (Költséghatékony, gyors).
   - Prompt Engineering: System Message dinamikus injektálása.

2. Biztonság (Secrets Management):
   - Fejlesztés alatt: `User Secrets` (dotnet user-secrets). A kulcsok nem kerülnek a Git repóba.
   - Éles környezet (Railway): Environment Variables (`OpenAI__ApiKey`).

3. Backend Architektúra:
   - Controller: `TranslationController` (fogadja a requestet, lekéri a CompanyType-ot).
   - Service: `OpenAiTranslationService` (végzi a kommunikációt az API-val).
   - Interface: `ITranslationService` (a tesztelhetőség és cserélhetőség miatt).


--------------------------------------------------------------------------------

  === FRONTEND I18N STRATÉGIA (SaaS) ===

1.  Tárolás:
    - Statikus fájl (`locales/hu.json`): Csak a Mester nyelv.
    - Adatbázis (`UiTranslationOverrides`): Minden más nyelv és egyedi felülírás.

2.  Store Logika (`translationStore.js`):
    - "Reset & Merge" stratégia: Nyelvváltáskor a store először kényszerítetten beállítja a Mester nyelvet az új nyelvkód alá, majd ráolvasztja az adatbázisból érkező különbségeket.
    - Kerüljük a `vue-i18n` beépített fallback mechanizmusát a kulcsok megjelenítése ellen; helyette explicit memóriamásolást használunk.

3.  UI Komponensek (PrimeVue v4 Standards):
    - A projekt szigorúan a PrimeVue v4 új API-ját követi.
    - Tilos használni: `TabView`, `AccordionTab`, `Dropdown`.
    - Kötelező használni: `Tabs`, `AccordionPanel`, `Select`.

  --------------------------------------------------------------------------------

  === BACKEND ASYNC WORKERS ===

1.  Translation Job:
    - A fordítási folyamatok (mivel sokáig tarthatnak) nem blokkolják a HTTP kérést.
    - Megvalósítás: `Task.Run` + `IServiceScopeFactory` (új scope nyitása a háttérszálnak).
    - Progress Tracking: A job szakaszosan ment a DB-be, frissítve a `CompanyLanguage.Progress` (0-100) mezőt.

================================================================================